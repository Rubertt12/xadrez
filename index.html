<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>War Engine v32.0 - Responsive Fullscreen</title>
    <style>
        :root { --bg: #050508; --panel: #0d0d12; --accent: #00e5ff; --danger: #ff0055; --sq-l: #1e1e24; --sq-d: #0a0a0f; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        body, html { 
            height: 100%; width: 100%; background: var(--bg); 
            font-family: 'Segoe UI', Roboto, sans-serif; color: white; 
            overflow: hidden; position: fixed; 
        }

        /* CONTAINER PRINCIPAL RESPONSIVO */
        .app-container {
            display: grid;
            width: 100vw;
            height: 100vh;
            grid-template-areas: "game" "dash";
            grid-template-rows: 1fr auto;
        }

        @media (min-width: 1000px) {
            .app-container {
                grid-template-areas: "game dash";
                grid-template-columns: 1fr 320px;
                grid-template-rows: 100vh;
            }
        }

        /* √ÅREA DO JOGO (CENTRALIZADA) */
        main {
            grid-area: game;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            position: relative;
        }

        .board-wrapper {
            position: relative;
            padding: min(4vw, 30px);
            background: #111;
            border-radius: 8px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        #board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            width: min(85vw, 85vh - 100px);
            height: min(85vw, 85vh - 100px);
            max-width: 600px;
            max-height: 600px;
            border: 2px solid #444;
        }

        /* COORDENADAS ADAPTATIVAS */
        .coord-h, .coord-v {
            position: absolute; display: flex; font-size: min(3vw, 14px); 
            color: #666; font-weight: bold; pointer-events: none;
        }
        .coord-h { width: calc(100% - min(8vw, 60px)); left: min(4vw, 30px); justify-content: space-around; }
        .coord-v { height: calc(100% - min(8vw, 60px)); top: min(4vw, 30px); flex-direction: column; justify-content: space-around; }
        .top { top: 5px; } .bottom { bottom: 5px; } .left { left: 8px; } .right { right: 8px; }

        /* PE√áAS E QUADRADOS */
        .sq { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; cursor: pointer; }
        .l { background: var(--sq-l); } .d { background: var(--sq-d); }
        .piece-container { width: 90%; height: 90%; position: relative; }
        .piece { width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; z-index: 2; }
        .btn-remove { 
            position: absolute; top: -5px; right: -5px; width: 18px; height: 18px; 
            background: var(--danger); border-radius: 50%; color: white; 
            display: flex; justify-content: center; align-items: center; font-size: 12px; z-index: 10;
        }

        /* DASHBOARD (DIREITA NO PC / BAIXO NO MOBILE) */
        #dashboard {
            grid-area: dash;
            background: var(--panel);
            padding: 15px;
            display: flex;
            flex-direction: row;
            gap: 10px;
            border-top: 1px solid #222;
            z-index: 100;
        }

        @media (min-width: 1000px) {
            #dashboard {
                flex-direction: column;
                border-top: none;
                border-left: 1px solid #222;
                justify-content: center;
            }
        }

        .player-card {
            flex: 1; display: flex; align-items: center; gap: 10px; 
            padding: 10px; border-radius: 10px; background: #000; border: 2px solid transparent;
        }
        .active-B { border-color: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.1); }
        .active-P { border-color: var(--danger); box-shadow: 0 0 15px rgba(255,0,85,0.1); }
        .p-img { width: 45px; height: 45px; border-radius: 8px; background-size: cover; background-position: center; background-color: #111; cursor: pointer; }
        .p-score { font-size: 20px; font-weight: 900; color: var(--accent); margin-left: auto; }

        /* ARENA DE BATALHA */
        .overlay { 
            display: none; position: fixed; inset: 0; z-index: 9000; 
            background: rgba(0,0,0,0.95); backdrop-filter: blur(10px);
            align-items: center; justify-content: center;
        }
        .arena-content {
            display: flex; flex-direction: column; align-items: center; gap: 20px;
            width: 90%; max-width: 500px;
        }
        .arena-fighters { display: flex; width: 100%; justify-content: space-between; align-items: center; gap: 10px; }
        .fighter { flex: 1; text-align: center; }
        .arena-box { 
            width: 100%; aspect-ratio: 3/4; max-height: 200px; 
            background: #111; border: 2px solid #333; border-radius: 8px;
            background-size: contain; background-repeat: no-repeat; background-position: center;
        }

        /* MENU E COMPONENTES */
        aside { 
            position: fixed; top: 0; left: -320px; width: 300px; height: 100%; 
            background: var(--panel); border-right: 2px solid var(--accent); 
            transition: 0.3s; z-index: 8000; display: flex; flex-direction: column; 
        }
        aside.open { left: 0; }
        #menu-toggle { 
            position: fixed; top: 15px; left: 15px; z-index: 8500; 
            width: 45px; height: 45px; background: var(--accent); border-radius: 10px; 
            display: flex; justify-content: center; align-items: center; color: #000; cursor: pointer;
        }
        .tabs { display: flex; background: #000; }
        .tabs button { flex: 1; padding: 12px; background: none; border: none; color: #555; font-size: 10px; font-weight: bold; cursor: pointer; }
        .tabs button.active { color: var(--accent); border-bottom: 2px solid var(--accent); }
        .scroll-area { flex: 1; overflow-y: auto; padding: 15px; }
        .btn { width: 100%; padding: 12px; border-radius: 8px; border: none; font-weight: 900; cursor: pointer; text-transform: uppercase; margin-bottom: 8px; }
        .btn-yes { background: var(--accent); color: #000; }
        .unit-card { background: #1a1a24; padding: 10px; border-radius: 8px; margin-bottom: 10px; border: 1px solid #333; font-size: 11px; }
        
        input[type="range"] { width: 100%; accent-color: var(--accent); }
    </style>
</head>
<body>

<div id="menu-toggle" onclick="toggleMenu()">‚ò∞</div>

<aside id="sidebar">
    <div style="padding: 20px; border-bottom: 1px solid #333;">
        <h2 style="color:var(--accent); font-size: 16px;">WAR ENGINE 32.0</h2>
        <label style="font-size: 12px; margin-top: 10px; display: block; cursor:pointer">
            <input type="checkbox" id="edit-mode" onchange="renderBoard()"> MODO EDI√á√ÉO
        </label>
    </div>
    <div class="tabs">
        <button id="t-white" class="active" onclick="showTab('white')">BRANCAS</button>
        <button id="t-black" onclick="showTab('black')">PRETAS</button>
        <button id="t-sys" onclick="showTab('sys')">SISTEMA</button>
    </div>
    <div class="scroll-area" id="list-white"></div>
    <div class="scroll-area" id="list-black" style="display:none"></div>
    <div class="scroll-area" id="list-sys" style="display:none">
        <div class="unit-card"><b>MASTER VOLUME</b><input type="range" id="v-master" min="0" max="1" step="0.1" value="1" oninput="save()"></div>
        <button class="btn" onclick="rollInitiative()" style="background:#222; color:var(--accent)">üé≤ SORTEAR IN√çCIO</button>
    </div>
    <div style="padding: 15px; background: #000;"><button class="btn btn-yes" onclick="startBattle()">ATIVAR BATALHA</button></div>
</aside>

<div class="app-container">
    <main>
        <div class="board-wrapper">
            <div class="coord-h top"><span>A</span><span>B</span><span>C</span><span>D</span><span>E</span><span>F</span><span>G</span><span>H</span></div>
            <div class="coord-h bottom"><span>A</span><span>B</span><span>C</span><span>D</span><span>E</span><span>F</span><span>G</span><span>H</span></div>
            <div class="coord-v left"><span>8</span><span>7</span><span>6</span><span>5</span><span>4</span><span>3</span><span>2</span><span>1</span></div>
            <div class="coord-v right"><span>8</span><span>7</span><span>6</span><span>5</span><span>4</span><span>3</span><span>2</span><span>1</span></div>
            <div id="board"></div>
        </div>
    </main>

    <div id="dashboard">
        <div id="card-B" class="player-card">
            <div id="img-B" class="p-img" onclick="document.getElementById('f-av-B').click()"></div>
            <div style="font-size: 10px; color: #888; font-weight: bold;">BRANCO</div>
            <div id="score-B" class="p-score">0</div>
            <input type="file" id="f-av-B" style="display:none" onchange="upAvatar('B', this)">
        </div>
        <div id="card-P" class="player-card">
            <div id="img-P" class="p-img" onclick="document.getElementById('f-av-P').click()"></div>
            <div style="font-size: 10px; color: #888; font-weight: bold;">PRETO</div>
            <div id="score-P" class="p-score" style="color:var(--danger)">0</div>
            <input type="file" id="f-av-P" style="display:none" onchange="upAvatar('P', this)">
        </div>
    </div>
</div>

<div id="arena" class="overlay">
    <div class="arena-content">
        <div class="arena-fighters">
            <div class="fighter">
                <div id="a-img" class="arena-box" style="border-color: var(--accent)"></div>
                <div style="display:flex; gap:5px; margin-top:8px">
                    <button class="btn" onclick="audioAction('atk','play')" style="background:#004444; font-size:10px; padding:8px">‚ñ∂</button>
                    <button class="btn" onclick="audioAction('atk','pause')" style="background:#440000; font-size:10px; padding:8px">||</button>
                </div>
                <button class="btn btn-yes" onclick="finishDuel('atk')" style="margin-top:8px; font-size:10px">VENCEU</button>
            </div>
            <h1 style="font-size: 30px;">VS</h1>
            <div class="fighter">
                <div id="d-img" class="arena-box" style="border-color: var(--danger)"></div>
                <div style="display:flex; gap:5px; margin-top:8px">
                    <button class="btn" onclick="audioAction('def','play')" style="background:#004444; font-size:10px; padding:8px">‚ñ∂</button>
                    <button class="btn" onclick="audioAction('def','pause')" style="background:#440000; font-size:10px; padding:8px">||</button>
                </div>
                <button class="btn" onclick="finishDuel('def')" style="background:var(--danger); color:#fff; margin-top:8px; font-size:10px">VENCEU</button>
            </div>
        </div>
        <button class="btn" onclick="closeArena()" style="background:#222; width:120px; font-size:10px">CANCELAR</button>
    </div>
</div>

<script>
    let db, store = { p: {}, g: {killsB:0, killsP:0, avatarB:'', avatarP:''} };
    const req = indexedDB.open("WarEngine_v32", 1);
    req.onupgradeneeded = e => e.target.result.createObjectStore("assets");
    req.onsuccess = e => { db = e.target.result; loadData(); };

    let isLive = false, turn = 'B', sel = null, pending = null;
    let audioAtk = new Audio(), audioDef = new Audio();

    const pe√ßasIds = ['T1','C1','B1','Q1','K1','B2','C2','T2','P1','P2','P3','P4','P5','P6','P7','P8'];
    const layout = [...pe√ßasIds.map(p=>p+'_P'), ...Array(32).fill(null), ...pe√ßasIds.map(p=>p+'_B')];
    let board = [...layout];

    function loadData() {
        db.transaction("assets").objectStore("assets").get("all").onsuccess = e => {
            if(e.target.result) store = e.target.result;
            renderBoard(); updateUI(); renderConfigLists();
        };
    }

    function renderBoard() {
        const b = document.getElementById('board'); b.innerHTML = '';
        const isEdit = document.getElementById('edit-mode').checked;
        board.forEach((id, i) => {
            const sq = document.createElement('div'); sq.className = `sq ${(Math.floor(i/8)+i%8)%2==0?'l':'d'}`;
            sq.onclick = () => handleSq(i);
            if(id) {
                const cont = document.createElement('div'); cont.className='piece-container';
                const p = document.createElement('div'); p.className = 'piece';
                if(store.p[id]?.img) p.style.backgroundImage = `url(${store.p[id].img})`;
                else p.style.backgroundColor = id.endsWith('_B') ? '#fff' : '#f05';
                cont.appendChild(p);
                if(isEdit) {
                    const x = document.createElement('div'); x.className='btn-remove'; x.innerText='√ó';
                    x.onclick=(e)=>{ e.stopPropagation(); board[i]=null; renderBoard(); save(); };
                    cont.appendChild(x);
                }
                sq.appendChild(cont);
            }
            b.appendChild(sq);
        });
    }

    function handleSq(i) {
        if(!isLive) return;
        if(sel === null) {
            if(board[i]?.endsWith('_'+turn)) { sel = i; renderBoard(); document.getElementById('board').children[i].style.background = "#004444"; }
        } else {
            if(board[i]?.endsWith('_'+turn)) { sel = i; renderBoard(); document.getElementById('board').children[i].style.background = "#004444"; }
            else if(board[i]) { 
                pending = {f:sel, t:i}; 
                setupArenaAudio(); document.getElementById('arena').style.display = 'flex'; updateArena(); 
            }
            else { board[i]=board[sel]; board[sel]=null; nextTurn(); }
        }
    }

    function setupArenaAudio() {
        const idAtk = board[pending.f], idDef = board[pending.t];
        audioAtk.src = store.p[idAtk]?.snd || ""; audioDef.src = store.p[idDef]?.snd || "";
        const mVol = document.getElementById('v-master').value;
        audioAtk.volume = (store.p[idAtk]?.vol ?? 0.7) * mVol;
        audioDef.volume = (store.p[idDef]?.vol ?? 0.7) * mVol;
    }

    function audioAction(role, act) { (role === 'atk' ? audioAtk : audioDef)[act](); }
    function updateArena() {
        document.getElementById('a-img').style.backgroundImage = `url(${store.p[board[pending.f]]?.img || ''})`;
        document.getElementById('d-img').style.backgroundImage = `url(${store.p[board[pending.t]]?.img || ''})`;
    }

    function finishDuel(winner) {
        closeArena();
        if(winner==='atk') {
            if(turn==='B') store.g.killsB++; else store.g.killsP++;
            board[pending.t]=board[pending.f]; board[pending.f]=null;
        } else {
            if(turn==='B') store.g.killsP++; else store.g.killsB++;
            board[pending.f]=null;
        }
        nextTurn(); save();
    }

    function renderConfigLists() {
        ['white','black'].forEach(side => {
            const team = side === 'white' ? 'B' : 'P';
            const cont = document.getElementById('list-'+side);
            cont.innerHTML = `<h3>PE√áAS ${side.toUpperCase()}</h3>`;
            pe√ßasIds.forEach(p => {
                const id = `${p}_${team}`;
                if(!store.p[id]) store.p[id] = {vol: 0.7};
                const d = document.createElement('div'); d.className = 'unit-card';
                d.innerHTML = `<b>${id}</b><br>
                    IMG: <input type="file" onchange="upPiece('${id}','img',this)"><br>
                    SOM: <input type="file" onchange="upPiece('${id}','snd',this)"><br>
                    VOL: <input type="range" min="0" max="1" step="0.1" value="${store.p[id].vol}" oninput="updatePieceVol('${id}', this.value)">`;
                cont.appendChild(d);
            });
        });
    }

    function updatePieceVol(id, val) { store.p[id].vol = parseFloat(val); save(); }
    function upPiece(id, type, input) {
        const r = new FileReader(); r.onload = e => { store.p[id][type] = e.target.result; save(); renderBoard(); };
        r.readAsDataURL(input.files[0]);
    }
    function upAvatar(side, input) {
        const r = new FileReader(); r.onload = e => { store.g['avatar'+side] = e.target.result; save(); updateUI(); };
        r.readAsDataURL(input.files[0]);
    }
    function showTab(t) {
        ['white','black','sys'].forEach(id => document.getElementById('list-'+id).style.display = (id===t?'block':'none'));
        ['t-white','t-black','t-sys'].forEach(id => document.getElementById(id).className = (id==='t-'+t?'active':''));
    }
    function nextTurn() { turn = turn==='B'?'P':'B'; sel=null; renderBoard(); updateUI(); }
    function closeArena() { document.getElementById('arena').style.display='none'; audioAtk.pause(); audioDef.pause(); }
    function toggleMenu() { document.getElementById('sidebar').classList.toggle('open'); }
    function startBattle() { isLive=true; toggleMenu(); updateUI(); }
    function rollInitiative() { turn = Math.random() < 0.5 ? 'B' : 'P'; updateUI(); alert("Come√ßa: " + (turn==='B'?'BRANCO':'PRETO')); }
    function updateUI() {
        document.getElementById('score-B').innerText = store.g.killsB; document.getElementById('score-P').innerText = store.g.killsP;
        document.getElementById('img-B').style.backgroundImage = `url(${store.g.avatarB})`; document.getElementById('img-P').style.backgroundImage = `url(${store.g.avatarP})`;
        document.getElementById('card-B').className = 'player-card' + (turn==='B'&&isLive?' active-B':'');
        document.getElementById('card-P').className = 'player-card' + (turn==='P'&&isLive?' active-P':'');
    }
    function save() { db.transaction("assets","readwrite").objectStore("assets").put(store,"all"); }
</script>
</body>
</html>